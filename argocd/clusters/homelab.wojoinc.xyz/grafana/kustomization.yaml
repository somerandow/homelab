---
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
patches:
  - target:
      kind: GrafanaDatasource
      name: prometheus
    patch: |-
      - op: replace
        path: /spec/datasource/url
        value: http://prometheus.monitoring.svc.homelab.wojoinc.local.:9090
  - target:
      kind: Grafana
      name: grafana
    patch: |-
      - op: replace
        path: /spec/config/server/root_url
        value: https://grafana2.wojoinc.xyz/
      - op: replace
        path: /spec/ingress/spec/rules/0/host
        value: grafana2.wojoinc.xyz
      - op: add
        path: /spec/ingress/spec/tls/0/hosts/0
        value: grafana2.wojoinc.xyz
  - target:
      kind: Grafana
    patch: |-
      apiVersion: grafana.integreatly.org/v1beta1
      kind: Grafana
      metadata:
        name: not-used
      spec:
        persistentVolumeClaim:
          spec:
            accessModes:
              - ReadWriteMany
            resources:
              storage: 1Gi
            storageClassName: "rook-cephfs"
