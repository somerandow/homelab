machine:
  sysctls:
    # Tuning based on https://github.com/onedr0p/home-ops/blob/main/talos/machineconfig.yaml.j2
    # and https://github.com/nexstorm/magicTCP
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.default_qdisc: fq
    net.core.rmem_max: 1073741824
    net.core.wmem_max: 1073741824
    net.ipv4.tcp_congestion_control: bbr
    net.ipv4.tcp_fastopen: 3
    net.ipv4.tcp_mtu_probing: 1
    net.ipv4.tcp_notsent_lowat: "131072"
    net.ipv4.tcp_rmem: 8192 262144 536870912
    net.ipv4.tcp_wmem: 8192 262144 536870912
    net.ipv4.tcp_adv_win_scale: -2
    net.ipv4.tcp_slow_start_after_idle: "0"
    net.ipv4.tcp_collapse_max_bytes: 6291456
    net.ipv4.tcp_window_scaling: 1
    sunrpc.tcp_slot_table_entries: 128
    sunrpc.tcp_max_slot_table_entries: 128
